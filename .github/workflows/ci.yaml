name: Build, Scan and Publish Image
on:
    push:
        branches:
          - main
    
permissions:
    contents: read
    security-events: write

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
      - name: Install node
        uses: actions/setup-node@v5
        with:
          node-version: "24.x"
      - name: NPM install and NPM audit
        run: |
          npm ci
          npm audit --audit-level=high
      - name: Setup Docker BuildX
        uses: docker/setup-buildx-action@v3
      - name: login to Docker Hub
        uses: docker/login-action@v3
        with:
            username: ${{ secrets.DOCKERHUB_USERNAME }}
            password: ${{ secrets.DOCKERHUB_PASSWORD }}